<%= content_for :ujs do %>
<%= render 'new' %>
<% end -%>

<h1 class="page-header">
  <% if can? :create, Georgia::Page %>
  <div class="pull-right">
    <%= link_to "#{icon_tag('icon-plus-sign')} Add Page".html_safe, '#new_page', class: 'btn btn-primary js-new-page', role: 'button', data: {toggle: 'modal'} %>
  </div>
  <% end -%>
  Pages
</h1>

<div class="row-fluid">
  <div class="span2">
    <%= render 'georgia/shared/search/pages' %>
    <h3>Filter Pages</h3>
    <%# FIXME, FIX the @#$ out of me. %>
    <%# This should be done with checkboxes, no reloading, possibly using an index, and should be handled by Backbone.js %>
    <%# Wow, this is crap. %>
    <h5><%= link_to 'All', georgia.pages_url %></h5>
    <h5>Status</h5>
    <ul class='nav'>
      <li><%= link_to "Draft (#{Georgia::Page.draft.count})", georgia.pages_url(status: Georgia::Status::DRAFT) %></li>
      <li><%= link_to "Published (#{Georgia::Page.published.count})", georgia.pages_url(status: Georgia::Status::PUBLISHED) %></li>
      <li><%= link_to "Pending Approval (#{Georgia::Page.pending_review.count})", georgia.pages_url(status: Georgia::Status::PENDING_REVIEW) %></li>
    </ul>
    <h5>Template</h5>
    <ul class='nav'>
      <% Georgia.templates.each do |t| %>
      <li><%= link_to "#{t} (#{Georgia::Page.where(template: t).count})", georgia.pages_url(template: t) %></li>
      <% end -%>
    </ul>
    <% if can? :create, Georgia::Page %>
    <div class="top20">
      <%= link_to "#{icon_tag('icon-plus-sign')} Add Page".html_safe, '#new_page', class: 'btn btn-primary js-new-page', role: 'button', data: {toggle: 'modal'} %>
    </div>
    <% end -%>
  </div>
  <div class="span10">
    <%= paginate @pages %>
    <table class="table table-hover top20">
      <thead>
        <th>Title</th>
        <th>Template</th>
        <th>URL</th>
        <th>Status</th>
        <th></th>
      </thead>
      <tbody>
        <% if @pages and @pages.any? %>
        <%= render @pages %>
        <% else %>
        <tr>
          <td colspan="6">
            There are currently no pages. <%= link_to 'Create a new one', '#new_page', class: 'js-new-page', data: {toggle: 'modal'} %>
          </td>
        </tr>
        <% end %>
      </tbody>
      <tfoot>
        <tr>
          <td colspan='6'>Showing <%= @pages.length %> of <%= Georgia::Page.count %> pages</td>
        </tr>
      </tfoot>
    </table>
    <%= paginate @pages %>
  </div>
</div>