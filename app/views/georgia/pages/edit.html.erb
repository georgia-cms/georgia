<%= simple_form_for @page, as: :page, url: url_for( controller: controller_name, action: :update, id: @page.id), remote: true, html: {class: 'form-vertical wait-and-spin', data: {'page-id' => @page.id}} do |f| %>
<header class='header-main'>
  <%= link_to icon_tag('level-up icon-rotate-270'), :back, class: 'btn-back' %>
  <ul class='nav'>
    <%= Georgia::EditPageActionList.new(self, @page, class: 'btn').render %>
  </ul>
  <ul class='nav' style='float: right;'>
    <li>
      <%= link_to 'Save & Publish', '#', class: 'btn' %>
    </li>
    <li>
      <button type="submit" class="btn">
        <%= icon_tag 'ok' %> Save
      </button>
    </li>
  </ul>
</header>
<div class='body-main'>
  <h1>
    <%= @page.title %>
    <small>
      <% if @page.public? %>
      <%= link_to @page.url, @page.url, target: '_blank' %>
      <% else -%>
      <%= @page.url %>
      <% end -%>
    </small>
  </h1>

  <% if extra_fields? %>
  <div class="well">
    <%= render partial: extra_fields_path, locals: {f: f, page: @page}  %>
  </div>
  <% end -%>

  <fieldset>
    <div class="fieldset-help">
      <legend>URL & Handle</legend>
      <p class="hint">
        The URL is automatically generated from the <%= instance_name %>'s hierarchy and title in the default language.
      </p>
    </div>
    <%= f.input :slug, label: false, input_html: {value: @page.url, data: {slug: @page.slug}} %>
  </fieldset>

  <fieldset>
    <div class="fieldset-help">
      <legend>Tags</legend>
      <p class="hint">
        Use tags to help Georgia understand what this page is about. Tags can later be used to show similar pages or pages sharing the same tags.<br />
        e.g. Interested in <em>Quidish</em>? Have you tried <a href='#'>Baseball</a> or <a href='#'>Criquet</a>?
      </p>
    </div>
    <%= f.input :tag_list, label: false, input_html: {class: 'js-token-input'} %>
  </fieldset>

  <fieldset>
    <div class="fieldset-help">
      <legend>Hierarchy</legend>
      <p class='hint'>
        Move the <%= instance_name.pluralize %> around to change their display position.
      </p>
    </div>
    <%= f.input :parent_id, collection: parent_page_collection, label: 'Parent', hint: "Leave empty if the #{instance_name} doesn't belong to any section.", input_html: {class: 'js-select2'} %>
    <div class="control-group">
      <%= label_tag :subpages %>
      <% if @page.persisted? and @page.has_children? %>
        <ul id="subpages" class="nav nav-stacked ui-sortable" data-sort-url="<%= sort_pages_path %>">
          <% Georgia::PagesDecorator.decorate(@page.children.ordered).each do |page| %>
            <%= content_tag_for(:li, page, class: 'subpage') do %>
              <%= icon_tag 'align-justify subpage-handle' %>
              <%= link_to icon_tag('long-arrow-right'), edit_page_path(page), class: 'subpage-edit-link' %>
              <div class="subpage-info">
                <h5 class='subpage-info__title'><%= page.title %></h5>
                <small class='subpage-info__url'><%= page.url %></small>
              </div>
            <% end -%>
          <% end -%>
        </ul>
      <% else -%>
        <p class='help-block'>There are no subpages for this <%= instance_name %>.</p>
      <% end -%>
    </div>
  </fieldset>
  <fieldset>
    <div class="fieldset-help">
      <legend>Revisions</legend>
    </div>
    <div class="control-group">
      <%= label_tag :pipeline, 'In the pipeline' %>
      <% if @page.revisions.drafts.any? %>
        <% @page.revisions.drafts.find_each do |draft| %>
          <p class='revision'>
            <span class="muted">#<%= draft.id %></span>
            <%= draft.title %> - <small>updated <%= time_ago_in_words draft.updated_at %> ago</small>
          </p>
        <% end -%>
      <% else -%>
        <p class='muted'>There is nothing in the pipeline.</p>
      <% end -%>
    </div>
    <div class="control-group">
      <%= label_tag :revisions %>
      <% if @page.revisions.stored.any? %>
        <% @page.revisions.stored.find_each do |revision| %>
          <p class='revision'>
            <span class="muted">#<%= revision.id %></span>
            <%= revision.title %> - <small>stored <%= time_ago_in_words revision.updated_at %> ago</small>
          </p>
        <% end -%>
      <% else -%>
        <p class='muted'>There are no revisions yet.</p>
      <% end -%>
    </div>
  </fieldset>
</div>
<footer>
  <hr />
  <%= link_to "#{icon_tag('trash')} Delete".html_safe, @page, data: {confirm: 'Are you sure?'}, method: :delete, class: 'btn' %>
</footer>
<% end %>